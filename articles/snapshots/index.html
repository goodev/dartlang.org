<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Product">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Snapshots in Dart | Dart: 结构化的web应用</title>
  <meta property="twitter:account_id" content="376585411" />
  <meta itemprop="name" content="Snapshots in Dart | Dart: 结构化的web应用">
  
  <meta itemprop="image" content="https://www.dartlang.org/imgs/dart-logo-900w.png">
  
  <meta itemprop="description" content="Learn how snapshots can help your apps start up faster.">

  <!-- Bootstrap core CSS -->
  <link href="/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="/css/dart-style.css" rel="stylesheet">
  <link href="/css/prettify.css" type="text/css" rel="stylesheet" />
  <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">
  <link href="//fonts.googleapis.com/css?family=Roboto:300,400" rel="stylesheet">
	
	<link rel="author" href="/authors/siva-annamalai.html">
	
	<link rel="alternate" type="application/atom+xml" href="http://news.dartlang.org/feeds/posts/default" title="Atom feed">
  <link href="https://plus.google.com/109866369054280216564" rel="publisher">

  <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
  <![endif]-->

  <!-- 
<script type="text/javascript">

  //var _gaq = _gaq || [];
 // _gaq.push(['_setAccount', 'UA-26406144-4']);
  //_gaq.push(['_setDomainName', 'dartlang.org']);
  //_gaq.push(['_setSiteSpeedSampleRate', 50]);
  //_gaq.push(['_trackPageview']);

 // (function() {
   // var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   // ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   // var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 // })();

</script>
-->
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F76b2695e71e6cec6e6af036d76afa367' type='text/javascript'%3E%3C/script%3E"));
</script>


  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script>
  

	window.___gcfg = {lang: 'en'};
	(function()
	{var po = document.createElement("script");
	po.type = "text/javascript"; po.async = true;po.src = "https://apis.google.com/js/plusone.js";
	var s = document.getElementsByTagName("script")[0];
	s.parentNode.insertBefore(po, s);
	})();
  </script>

  <script>
    window.twttr = (function (d,s,id) {
      var t, js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
      js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
      return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
    }(document, "script", "twitter-wjs"));
  </script>
</head>
<body onload="prettyPrint()">

    <div class="navbar navbar-fixed-top navbar-inverse" role="navigation">
      <div class="container">
        
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/"><i class="sprite-icon-dart-logo"></i></a>
        </div>

        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
           <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                       入门
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/codelabs/darrrt/">试试 Dart</a></li>
                <li><a href="/docs/tutorials/">Dart 教程</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                文档
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/docs/">开发者指南</a></li>
                <li><a href="http://api.dartlang.org">API 参考</a></li>
                <li><a href="/docs/spec/">语言规范</a></li>

                <li class="divider"></li>
                <li><a href="/docs/dart-up-and-running/">Dart: Up and Running</a></li>
                <li><a href="/books/">更多图书</a></li>

                <li class="divider"></li>
                <li><a href="/articles/">文章</a></li>
                <li><a href="/support/faq.html">FAQ</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                       工具
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/docs/dart-up-and-running/contents/ch04-tools-dart2js.html">dart2js</a>
                </li><li><a href="/tools/editor/">Dart Editor</a></li>
                <li><a href="http://pub.dartlang.org/">Pub Package Manager</a></li>
                <li><a href="/tools/">更多工具</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                     资源
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/samples/">示例代码</a></li>
                <li><a href="http://synonym.dartlang.org/">Translations from Dart</a></li>
                <li><a href="http://try.dartlang.org/">Try Dart!</a></li>

                <li class="divider"></li>
                <li><a href="/slides/">演示文稿</a></li>
                <li><a href="/dart-tips/">Dart 技巧视频</a></li>

                <li class="divider"></li>
                <li><a href="http://code.google.com/p/dart/issues/list">Bugs and Feature Requests</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                              社区
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/support/">支持和社区资源</a></li>
                <li><a href="http://code.google.com/p/dart/wiki/Contributing">Contributor's Guide</a></li>
              </ul>
            </li>
          </ul>

          <ul class="nav navbar-nav navbar-right">
            <li>
              <form class="navbar-search" action="/search.html" id="cse-search-box">
                <input type="hidden" name="cx" value="011220921317074318178:i4mscbaxtru">
                <input type="hidden" name="ie" value="UTF-8">
                <input type="hidden" name="hl" value="en">
                <input type="search" name="q" class="search-query placeholder-position-fix form-control" id="q" autocomplete="off" placeholder="Search">
              </form>
            </li>
            <li><a href="https://twitter.com/dart_lang" class="btn"><i class="sprite-icon-social-twitter"></i></a></li>
            <li><a href="https://plus.google.com/+dartlang/posts" class="btn"><i class="sprite-icon-social-gplus"></i></a></li>
          </ul>
        </div><!-- /.nav-collapse -->

      </div><!-- /.container -->
    </div><!-- /.navbar -->

  


<div class="container-page">
  <div class="container">
  	<div class="container sub-page">
      <div class="row">
        <article class="has-permalinks"><div class="col-md-3">
  <div class="bs-sidebar hidden-print affix-top" role="complementary">

<ol class="toc nav bs-sidenav" id="markdown-toc">
  <li><a href="#what-is-a-snapshot">What is a snapshot?</a></li>
  <li><a href="#how-the-browser-can-use-snapshots">How the browser can use snapshots</a></li>
  <li><a href="#how-to-generate-and-use-script-snapshots">How to generate and use script snapshots</a></li>
  <li><a href="#how-to-generate-full-snapshots">How to generate full snapshots</a></li>
  <li><a href="#summary">Summary</a></li>
</ol>

  </div>
</div>
<div class="col-md-7">
  <p><!-- Start of content -->
	</p>

  <h1 id="snapshots-in-dart">Snapshots in Dart</h1>

  <p><em>Written by Siva Annamalai <br />
<time pubdate="" date="2013-02-13">February 2013</time>
</em></p>

  <p>This article talks about snapshots in Dart—both
what they are and how they can make Dart apps start up faster.
If you write command-line apps,
you should be able to improve their startup time
by generating your own snapshots,
following the instructions in this article.</p>

  <p>If you write web apps, you don’t need to do anything:
browsers with the Dart VM can snapshot your app automatically.
The next time your web app runs,
the browser can retrieve the snapshot from the browser cache
and use it to start your app faster.</p>

  <h2 id="what-is-a-snapshot">What is a snapshot?</h2>

  <p>A snapshot is a sequence of bytes
that represents a serialized form
of one or more Dart objects.
This representation closely corresponds to
the way these Dart objects are represented
in an isolate’s heap in memory.</p>

  <p>The Dart VM uses snapshots for two main reasons:</p>

  <ul>
    <li>
      <p><strong>Speeding up initial startup time</strong>
for an application.
A snapshot of the core libraries and application script
typically contains preparsed data for
the core libraries and the application script.
This means it is not necessary to parse and tokenize
the libraries and script during startup.</p>
    </li>
    <li>
      <p><strong>Passing objects</strong>
from one isolate to another isolate.</p>
    </li>
  </ul>

  <p>The Dart VM uses the following kinds of snapshots:</p>

  <ul>
    <li>
      <p>A <strong>full snapshot</strong>,
which is a complete representation of
an isolate’s heap after it is initialized.
This is used by the Dart VM for
fast startup and initialization of
the entire Dart core library and other libraries
such as dart:uri, dart:io, dart:utf, dart:json, dart:isolate, and so on.</p>
    </li>
    <li>
      <p>A <strong>script snapshot</strong>,
which is a complete representation of
an application script in an isolate’s heap
after the script is loaded into the isolate,
but before the script starts executing.
This is used by the Dart VM for
fast startup and initialization of applications.
For example, the script that starts dart2js
uses a pre-created script snapshot of the dart2js application.</p>
    </li>
    <li>
      <p>An <strong>object snapshot</strong>.
Messaging from one isolate to another
is implemented in the Dart VM by
creating a snapshot of the Dart object
that needs to be sent to the other isolate.</p>
    </li>
  </ul>

  <h2 id="how-the-browser-can-use-snapshots">How the browser can use snapshots</h2>

  <p>A browser that contains the Dart VM uses
a full snapshot for fast startup and initialization
of the main Dart isolate.
This snapshot contains the entire Dart core library and other libraries
such as dart:uri, dart:utf, dart:json, dart:isolate, and dart:html.</p>

  <p>In addition, the browser could potentially generate
a script snapshot of an application that has been loaded
and cache it in the browser cache.
This cached script snapshot could then be used for
subsequent reloads of the application for faster application startup.</p>

  <h2 id="how-to-generate-and-use-script-snapshots">How to generate and use script snapshots</h2>

  <p>You can generate and use script snapshots using the Dart VM (dart).</p>

  <aside class="alert alert-info">
    <p><strong>Note:</strong>
Don’t bother creating a script
snapshot for a program that you’re going to run
just a few times.
A script snapshot is useful only for deployed applications
where the cost of creating the snapshot
is amortized over many launches.</p>
  </aside>

  <p>To generate a script snapshot,
use dart with the <code>--snapshot</code> option.
You can use the <code>--package_root</code> option
to specify the location of packages used in imports
(<code>import 'package:...'</code>).</p>

  <pre>
dart <em>[</em>--package_root=<em>path]</em> --snapshot=<em>out-file</em> <em>dart-script-file</em>
</pre>

  <p>The <code>--snapshot</code> option writes
a script snapshot of <em>dart-script-file</em> to <em>out-file</em>.
For example, the following command creates
a snapshot of the Dart script <code>dart2js.dart</code>,
putting it into a file called <code>dart2js.snapshot</code>.</p>

  <pre class="prettyprint lang-sh">dart --snapshot=dart2js.snapshot \ 
    dart-sdk/lib/dart2js/lib/_internal/compiler/implementation/dart2js.dart</pre>

  <p>To execute a script from its snapshot,
specify the snapshot file on the command line:</p>

  <pre>
dart <em>snapshot-file</em> <em>args</em>
</pre>

  <p>Any <em>args</em> you specify are passed to the script.
For example, you can run dart2js like this,
passing <code>myscript.dart -oout.js</code> as command-line arguments to dart2js:</p>

  <pre class="prettyprint lang-sh">dart dart2js.snapshot myscript.dart -oout.js</pre>

  <h2 id="how-to-generate-full-snapshots">How to generate full snapshots</h2>

  <p>Read this section if you’re working on
one of the rare projects that embed the Dart VM (for example, Dartium).
The gen_snapshot tool writes a full snapshot
(corelibs, dart:uri, dart:io, dart:utf, dart:json, dart:isolate, …)
to <em>out-file</em>:</p>

  <pre>
gen_snapshot <em>[options]</em> --snapshot=<em>out-file</em>
</pre>

  <p>You can use the following <em>options</em>:</p>

  <table class="table">
  <tr style="text-align:left">
    <th>Option</th> <th>Description</th>
  </tr>
  <tr>
    <td class="nowrap">
      --package_root=<em>path</em>
    </td>
    <td>
      Specifies the location of packages used in imports
      (<code>import 'package:...'</code>).</td>
  </tr>
  <tr>
    <td class="nowrap">
      --url_mapping=<em>mapping</em>
    </td>
    <td>
      Provides a URL mapping on the command line for URI resolution
      during library imports.</td>
  </tr>
</table>

  <h2 id="summary">Summary</h2>

  <p>You can find more information about snapshots
and how they are implemented by browsing the files in the
<a href="http://code.google.com/p/dart/source/browse/#svn%2Fbranches%2Fbleeding_edge%2Fdart%2Fruntime%2Fvm">dart/runtime/vm directory</a>.
Start by looking for “Snapshot” in
<a href="http://code.google.com/p/dart/source/browse/branches/bleeding_edge/dart/runtime/vm/snapshot.h">snapshot.h</a>.
Note that the code might move as the implementation changes.</p>
</div>

    	  </div> <!-- End of content from toc.html -->
        </article>
	  </div>

	
	<ul class="pager">
	  <li><a href="/articles/">More articles about Dart <i class="glyphicon glyphicon-chevron-up"></i></a></li>
	 </ul>
	 

	</div>
  </div>
</div>


  <footer class="footer container-full">
    <div class="container">
      <div class="row">
        <div class="col-md-5">
          <h3>一种用于创建可扩展 web 应用程序的语言、工具和代码库</h3>
          <p>Dart 是一个 <a href="https://code.google.com/p/dart/">开源项目</a>，由  Google 和其他人员参与。</p>
          <p class="sm">除非注明，该页面内容使用 the Creative Commons Attribution 3.0 License 发布，示例代码使用  BSD License 发布。</p>
          <!-- 
          <p><a class="saelogo" href="http://sae.sina.com.cn/activity/invite/15649/weibo" target="_blank"><img src="http://static.sae.sina.com.cn/image/poweredby/poweredby.png" title="Powered by Sina App Engine"></a></p>     	
          -->
        </div>
        <div class="col-md-2 col-md-offset-1">
          <h4>受欢迎的文章</h4>
          <ul>
            <li><a href="/polymer-dart/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">Polymer.dart</a></li>
            <li><a href="/performance/">性能</a></li>
            <li><a href="/docs/dart-up-and-running/contents/ch02.html?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">语言概览</a> &amp;
            <a href="/docs/dart-up-and-running/contents/ch03.html?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">代码库概览</a></li>
            <li><a href="/samples/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">示例代码</a></li>
            <li><a href="/docs/tutorials/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">教程</a> &amp;
                <a href="/codelabs/darrrt/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">代码实验室</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <h4>资源</h4>
          <ul>
            <li><a href="http://pub.dartlang.org/">Pub packages</a></li>
            <li><a href="http://synonym.dartlang.org/">Translations from Dart</a></li>
            <li><a href="http://code.google.com/p/dart/issues/list">Dart bugs and feature requests</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <h4>社区</h4>
          <ul>
            <li><a href="/support/">邮件列表</a></li>
            <li><a href="http://bbs.dartlang.cc">中文社区</a></li>
            <li><a href="https://plus.google.com/communities/114566943291919232850">G+ 社区</a></li>
            <li><a href="https://plus.google.com/+dartlang/posts">G+ 新闻发布频道</a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/dart">Stack Overflow</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer> <!-- End footer -->

<script type='text/javascript' src='/js/jquery.js'></script>
<script type='text/javascript' src='/js/bootstrap.min.js'></script>
<script type='text/javascript' src='/js/social-event-analytics.js'></script>
<script type='text/javascript' src='/js/prettify.js'></script>
<script type='text/javascript' src='/js/lang-dart.js'></script>
<script type='text/javascript' src='/js/lang-yaml.js'></script>
<script type='text/javascript' src='/js/scripts.js'></script>




</body>
</html>

