<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Product" xmlns:wb="http://open.weibo.com/wb">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Writing Unit Tests for Pub Packages | Dart: 用于创建结构化的web应用</title>
  <meta property="wb:webmaster" content="a984f6440858ee44" />
  <meta property="twitter:account_id" content="376585411" />
  <meta itemprop="name" content="Writing Unit Tests for Pub Packages | Dart: 用于创建结构化的web应用">
  
  <meta itemprop="image" content="https://www.dartlang.org/imgs/dart-logo-wordmark-1200w.png">
  
  <meta itemprop="description" content="Learn how to write unit tests for your pub packages using the unittest library">


  <link rel='stylesheet' type='text/css' href='/css/bootstrap.min.css'>
<link rel='stylesheet' type='text/css' href='/css/dart-style.css'>
<link rel='stylesheet' type='text/css' href='/css/prettify.css'>

  
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:300,400" rel="stylesheet">

	
	<link rel="author" href="/authors/shailen-tuli.html">
	
	<link rel="alternate" type="application/atom+xml" href="http://dartnews.sinaapp.com/?feed=atom" title="Atom feed">
  <!-- 
  <link href="https://plus.google.com/109866369054280216564" rel="publisher">
  -->
  <link href="http://weibo.com/cndart" rel="publisher">

  <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
  <![endif]-->

  <!-- 
<script type="text/javascript">

  //var _gaq = _gaq || [];
 // _gaq.push(['_setAccount', 'UA-26406144-4']);
  //_gaq.push(['_setDomainName', 'dartlang.org']);
  //_gaq.push(['_setSiteSpeedSampleRate', 50]);
  //_gaq.push(['_trackPageview']);

 // (function() {
   // var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   // ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   // var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 // })();

</script>
-->


  <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
</head>
<body onload="prettyPrint()">
    <div class="navbar navbar-fixed-top navbar-inverse" role="navigation">
      <div class="container">
        
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/"><i class="sprite-icon-dart-logo"></i></a>
        </div>

        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
           <li class="dropdown">
              <a href="/codelabs/darrrt/" title="Learn Dart in this short code lab.">
                                                       入门
              </a>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                文档
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/docs/tutorials/">教程</a></li>
                <li class="divider"></li>
                 
                <li><a href="/docs/">开发者指南</a></li>
                <li><a href="http://api.dartlang.org">API 参考</a></li>
                <li><a href="/docs/spec/">语言规范</a></li>

                <li class="divider"></li>
                <li><a href="/docs/dart-up-and-running/">Dart: Up and Running</a></li>
                <li><a href="/books/">更多图书</a></li>

                <li class="divider"></li>
                <li><a href="/articles/">文章</a></li>
                <li><a href="/support/faq.html">FAQ</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                       工具
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/docs/dart-up-and-running/contents/ch04-tools-dart2js.html">dart2js</a>
                </li><li><a href="/tools/editor/">Dart Editor</a></li>
                <li><a href="http://pub.dartlang.org/">Pub Package Manager</a></li>
                <li><a href="/tools/">更多工具</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                     资源
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/samples/">示例代码</a></li>
                <li><a href="http://synonym.dartlang.org/">Translations from Dart</a></li>

                <li class="divider"></li>
                <li><a href="/slides/">演示文稿</a></li>
                <li><a href="/dart-tips/">Dart 短视频</a></li>

                <li class="divider"></li>
                <li><a href="/performance/">性能</a></li>
                <li class="divider"></li>
                <li><a href="http://code.google.com/p/dart/issues/list">Bugs and Feature Requests</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="/support/" title="Community and Support">
                                              社区
              </a>
            </li>
          </ul>

          <ul class="nav navbar-nav navbar-right">
            <li>
              <form class="navbar-search" action="/search.html" id="cse-search-box">
                <input type="hidden" name="cx" value="011220921317074318178:i4mscbaxtru">
                <input type="hidden" name="ie" value="UTF-8">
                <input type="hidden" name="hl" value="en">
                <input type="search" name="q" class="search-query placeholder-position-fix form-control" id="q" autocomplete="off" placeholder="Search">
              </form>
            </li>
            <li><a target="_blank" href="https://twitter.com/dart_lang" class="btn"><i class="sprite-icon-social-twitter"></i></a></li>
            <li><a target="_blank" href="https://plus.google.com/+dartlang/posts" class="btn"><i class="sprite-icon-social-gplus"></i></a></li>
            <li><a target="_blank" href="http://weibo.com/cndart" class="btn"><i class="sprite-icon-social-weibo"><img src="/imgs/weibo.png"></i></a></li>
          </ul>
        </div><!-- /.nav-collapse -->

      </div><!-- /.container -->
    </div><!-- /.navbar -->

  


<div class="container-page">
  <div class="container">
  	<div class="container sub-page">
      <div class="row">
        <article class="has-permalinks"><div class="col-md-3">
  <div class="bs-sidebar hidden-print affix-top" role="complementary">

<ol class="toc nav bs-sidenav" id="markdown-toc">
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#create-a-simple-package">Create a simple package</a></li>
  <li><a href="#add-the-unittest-package-to-your-library">Add the unittest package to your library</a></li>
  <li><a href="#write-some-code">Write some code</a></li>
  <li><a href="#write-some-tests">Write some tests</a></li>
  <li><a href="#summary">Summary</a></li>
</ol>

  </div>
</div>
<div class="col-md-7">
  <p><!-- Start of content -->
	</p>

  <h1 id="writing-unit-tests-for-pub-packages">Writing Unit Tests for Pub Packages</h1>

  <p><em>Written by Shailen Tuli<br />
<time pubdate="" date="2012-11-01">November 2012</time>
</em></p>

  <h2 id="introduction">Introduction</h2>

  <p>This article shows you how to create a really simple Dart
package. Because we would never want to write a package without testing
the code in it, this article also introduces you to the excellent unittest library.</p>

  <p><a href="http://pub.dartlang.org/">Pub</a> is Dart’s package mananger. After working 
through this post, you will be able to bundle your Dart libraries and share
them with others on pub.dartlang.org.</p>

  <p>For the purposes of this post, our basic package consists of
a single <code>range()</code> function modeled roughly on the Python builtin function with
the same name.  </p>

  <p><code>range()</code> has the following signature: </p>

  <pre class="prettyprint lang-dart">List&lt;num&gt; range(num start, num stop, [num step = 1]);</pre>

  <p>It returns a list of ints between <code>start</code> and <code>stop</code> separated by <code>step</code>
steps. Here is some sample usage:</p>

  <pre class="prettyprint lang-dart">range(0, 4);    // [0, 1, 2, 3]
range(1, 6, 2); // [1, 3, 5]</pre>

  <p>Let’s get started.</p>

  <h2 id="create-a-simple-package">Create a simple package</h2>

  <p>Open up Dart Editor, and create a new application called <strong>range</strong>. This new 
application is not a web project, so uncheck <strong>Generate content for a
basic web app</strong>.  But do make sure that <strong>Add Pub support</strong> is checked.  </p>

  <p><img src="imgs/creating_a_dart_app.jpg" alt="Creating a new non-web Dart application" /></p>

  <p>Delete the automatically created <code>bin</code> directory. You don’t need it.</p>

  <p>Create a top-level <code>lib</code> directory. Inside <code>lib</code>, create a <code>range.dart</code> file;
the code for <code>range()</code> goes in here. (We’ll get rid of the automatically 
created <code>class Range {}</code> code when we define our <code>range()</code> function.)</p>

  <p>We should create other directories and files, as well—a
LICENSE, a <code>doc</code> directory for documentation, an <code>example</code> directory with examples 
showing usage of our package, and so on—but our focus here is on how to write
unit tests, so we’ll skip over those files and directories for now. To know
what else we should be doing to make this a <em>respectable</em> package, see the
excellent writeup of
<a href="http://pub.dartlang.org/doc/package-layout.html">package layout conventions</a>.</p>

  <h2 id="add-the-unittest-package-to-your-library">Add the unittest package to your library</h2>

  <p>With the basic files created for our package, let’s open up <code>pubspec.yaml</code> 
and add some metadata for our pub package, following the
<a href="http://pub.dartlang.org/doc/pubspec.html">pubspec format</a>.
Every package <strong>must</strong> contain a <code>pubspec.yaml</code>; in fact, it is this file
that makes it a package. </p>

  <p>Add a simple description for the package and specify its only dependency,
the unittest package. Your <code>pubspec.yaml</code> should look like this:</p>

  <pre class="prettyprint lang-dart">name: range
description: An approximate implementation of the Python range() function.
    
dependencies:
  unittest: any</pre>

  <p>Saving <code>pubspec.yaml</code> in Dart Editor automatically triggers a call to 
<code>pub install</code>; this creates a <code>pubspec.lock</code> file and a bunch of symlinks
that are necessary for the plumbing to work correctly. Fortunately, 
<code>pub</code> handles all these details for us. </p>

  <h2 id="write-some-code">Write some code</h2>

  <p>Let’s create a bare-bones implementation for <code>range()</code>. Your <code>lib/range.dart</code>
should look like this:</p>

  <pre class="prettyprint lang-dart">library range; 

List&lt;int&gt; range(int start, int stop, [int step=1]) {
  if (start &gt;= stop) {
    throw new ArgumentError(&quot;start must be less than stop&quot;);
  }

  List&lt;int&gt; list = [];
  
  for (var i = start; i &lt; stop; i+= step) {
    list.add(i);
  }

  return list;
}</pre>

  <h2 id="write-some-tests">Write some tests</h2>

  <p>Create a top-level <code>test</code> directory. Inside <code>test</code>, create a <code>range_test.dart</code>
file; our tests go in here. Remove the <code>class RangeTest {}</code> code from this file.
We won’t be needing it for this simple example.</p>

  <p>Before we can run our tests, <code>test/range_test.dart</code> needs access to the 
<code>unittest</code> package and the <code>range</code> library. At the top of <code>range_test.dart</code>, 
add these import statements:</p>

  <pre class="prettyprint lang-dart">import 'package:unittest/unittest.dart';
import 'package:range/range.dart';</pre>

  <p>Now add a couple of tests. (We’ll need many more to really test <code>range()</code>, but
these are a good start.) Your <code>range_test.dart</code> should look like this:</p>

  <pre class="prettyprint lang-dart">import 'package:unittest/unittest.dart';
import 'package:range/range.dart';

void main() {
  test(&quot;range() produces a list that starts at start&quot;, () {
    expect(range(0, 4)[0], equals(0));
  });

  test(&quot;range() throws an exception when start &gt; stop&quot;, () {
    expect(() =&gt; range(5, 2), throwsA(new isInstanceOf&lt;ArgumentError&gt;()));
  });      
}</pre>

  <p>An individual test goes inside <code>test()</code>. The <code>expect()</code> function
evaluates the equality
between the expected and actual values. A string argument to <code>test()</code> describes
the purpose of the test. </p>

  <p>If you run the tests now and get an error because Dart Editor cannot locate the
unittest library, try running <code>pub update</code>. (You can find it in Dart Editor’s
<strong>Tools</strong> menu.) You should see the following output
in Dart Editor:</p>

  <pre><code>Running pub update ...
Resolving dependencies...
Dependencies updated!
</code></pre>

  <p>After running <code>pub update</code>, you should see a newly created <code>packages</code> symlink 
in the <code>test</code> directory that gives your tests access to the unittest
library. (<code>pub update</code> recursively creates symlinks in every subdirectory of 
<code>/test</code>, <code>/web</code>, and <code>/bin</code>; it does <em>not</em> create symlinks in <code>lib</code>.)</p>

  <p>Now run the tests by pressing the green arrow in Dart Editor, or pressing 
<strong>Cmd+R</strong> on a Mac, or typing <code>dart test/range_test.dart</code> on the
command line. You should see the following output:</p>

  <pre><code>unittest-suite-wait-for-done
PASS: range() produces a list that starts at start
PASS: range() throws an exception when start &gt; stop

All 2 tests passed.
unittest-suite-success
</code></pre>

  <p>We’ve made good progress, but our test coverage is still pretty limited. Let’s
add a few more tests and group them in a way that makes our testing strategy
clear. Change <code>range_test.dart</code> so it looks like this:</p>

  <pre class="prettyprint lang-dart">import 'package:unittest/unittest.dart';
import 'package:range/range.dart';

void main() {
  group(&quot;range()&quot;, () {
    group(&quot;produces a list that&quot;, () {
      test(&quot;starts at start&quot;, () {
        expect(range(0, 4)[0], equals(0));
      });

      test (&quot;stops before stop&quot;, () {
        expect(range(0, 4).last, equals(3));
      });

      test(&quot;has consecutive values if no step is given&quot;, () {
        expect(range(1, 6), equals([1, 2, 3, 4, 5]));
      });

      test(&quot;has non-consecutive values with step &gt; 1&quot;, () {
        expect(range(1, 6, 2), equals([1, 3, 5]));
      });
    });

    group(&quot;throws an exception when&quot;, () {
      test(&quot;start &gt; stop&quot;, () {
        expect(() =&gt; range(5, 2), throwsA(new isInstanceOf&lt;ArgumentError&gt;()));
      });

      test(&quot;start == stop&quot;, () {
        expect(() =&gt; range(5, 5), throwsA(new isInstanceOf&lt;ArgumentError&gt;()));
      });
    });
  });
}</pre>

  <p>Much better. We use nested calls to <code>group()</code> to organize our tests, and we pass
descriptive string args to each <code>group()</code> call to indicate our intent. If
you run the tests again, you should see:</p>

  <pre><code>unittest-suite-wait-for-done
PASS: range() produces a list that starts at start
PASS: range() produces a list that stops before stop
PASS: range() produces a list that has consecutive values if no step is given
PASS: range() produces a list that has non-consecutive values with step &gt; 1
PASS: range() throws an exception when start &gt; stop
PASS: range() throws an exception when start == stop

All 6 tests passed.
unittest-suite-success
</code></pre>

  <h2 id="summary">Summary</h2>

  <p>We created a minimal Dart package, made it (barely) good enough
to put on pub.dartlang.org, and wrote a few tests.  This is a good start, of course, but
we have only scratched the surface of how we should test our packages. For a
very thorough explanation of how the unittest framework works in Dart, I 
highly recommend a careful reading of 
<a href="/articles/dart-unit-tests/">Unit Testing with Dart</a> by 
Graham Wheeler. He goes into considerable detail about writing tests, defining
<code>setUp()</code> and <code>tearDown()</code>, running asynchronous tests, using and creating
matchers, and configuring your test environment.</p>

</div>

    	  </div> <!-- End of content from toc.html -->
        </article>
	  </div>

	
	<ul class="pager">
	  <li><a href="/articles/">关于 Dart 的更多文章 <i class="glyphicon glyphicon-chevron-up"></i></a></li>
	 </ul>
	 

	</div>
  </div>
</div>

  <footer class="footer container-full">
    <div class="container">
      <div class="row">
        <div class="col-md-5">
          <h3>一种用于创建可扩展 web 应用程序的语言、工具和代码库</h3>
          <p>Dart 是一个 <a href="https://code.google.com/p/dart/">开源项目</a>，由  Google 和其他人员参与。</p>
          <p class="sm">除非注明，该页面内容使用 the Creative Commons Attribution 3.0 License 发布，示例代码使用  BSD License 发布。</p>
          <!-- 
          <p><a class="saelogo" href="http://sae.sina.com.cn/activity/invite/15649/weibo" target="_blank"><img src="http://static.sae.sina.com.cn/image/poweredby/poweredby.png" title="Powered by Sina App Engine"></a></p>     	
          -->
        </div>
        <div class="col-md-2 col-md-offset-1">
          <h4>受欢迎的文章</h4>
          <ul>
            <li><a href="/polymer-dart/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">Polymer.dart</a></li>
            <li><a href="/performance/">性能</a></li>
            <li><a href="/docs/dart-up-and-running/contents/ch02.html?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">语言概览</a> &amp;
            <a href="/docs/dart-up-and-running/contents/ch03.html?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">代码库概览</a></li>
            <li><a href="/samples/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">示例代码</a></li>
            <li><a href="/docs/tutorials/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">教程</a> &amp;
                <a href="/codelabs/darrrt/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">代码实验室</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <h4>资源</h4>
          <ul>
            <li><a href="http://pub.dartlang.org/">Pub packages</a></li>
            <li><a href="http://synonym.dartlang.org/">Translations from Dart</a></li>
            <li><a href="http://code.google.com/p/dart/issues/list">Dart bugs and feature requests</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <h4>社区</h4>
          <ul>
            <li><a href="/support/">邮件列表</a></li>
            <li><a href="http://bbs.dartlang.cc">中文社区</a></li>
            <li><a href="https://plus.google.com/communities/114566943291919232850">G+ 社区</a></li>
            <li><a href="https://plus.google.com/+dartlang/posts">G+ 新闻发布频道</a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/dart">Stack Overflow</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer> <!-- End footer -->

<script type='text/javascript' src='/js/jquery.js'></script>
<script type='text/javascript' src='/js/bootstrap.min.js'></script>
<script type='text/javascript' src='/js/prettify.js'></script>
<script type='text/javascript' src='/js/lang-dart.js'></script>
<script type='text/javascript' src='/js/lang-yaml.js'></script>
<script type='text/javascript' src='/js/scripts.js'></script>




<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F76b2695e71e6cec6e6af036d76afa367' type='text/javascript'%3E%3C/script%3E"));
</script>

<!-- Baidu Button BEGIN -->
<script type="text/javascript" id="bdshare_js" data="type=slide&amp;img=1&amp;pos=left&amp;uid=590574" ></script>
<script type="text/javascript" id="bdshell_js"></script>
<script type="text/javascript">
var bds_config={"bdTop":367};
document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000);
</script>
<!-- Baidu Button END -->
</body>
</html>

