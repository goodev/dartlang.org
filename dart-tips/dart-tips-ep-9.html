<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Product" xmlns:wb="http://open.weibo.com/wb">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>异常处理 - Dart 技巧， 第九集 | Dart: 用于创建结构化的web应用</title>
  <meta property="wb:webmaster" content="a984f6440858ee44" />
  <meta property="twitter:account_id" content="376585411" />
  <meta itemprop="name" content="异常处理 - Dart 技巧， 第九集 | Dart: 用于创建结构化的web应用">
  
  <meta itemprop="image" content="//dartpic.goodev.org/dartlang/vi/J94I70uqr6w/0.jpg">
  
  <meta itemprop="description" content="学习 Dart 如何优雅的处理异常和错误。当下次再遇到错误的时候，不要吓的措手不及。学习 try、 catch、 finally、 和 throw。  ">

  <!-- Bootstrap core CSS -->
  <link href="/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="/css/dart-style.css" rel="stylesheet">
  <link href="/css/prettify.css" type="text/css" rel="stylesheet" />
  <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">
  <link href="//fonts.googleapis.com/css?family=Roboto:300,400" rel="stylesheet">
	
	<link rel="author" href="/authors/seth-ladd.html">
	
	<link rel="alternate" type="application/atom+xml" href="http://dartnews.sinaapp.com/?feed=atom" title="Atom feed">
  <!-- 
  <link href="https://plus.google.com/109866369054280216564" rel="publisher">
  -->
  <link href="http://weibo.com/cndart" rel="publisher">

  <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
  <![endif]-->

  <!-- 
<script type="text/javascript">

  //var _gaq = _gaq || [];
 // _gaq.push(['_setAccount', 'UA-26406144-4']);
  //_gaq.push(['_setDomainName', 'dartlang.org']);
  //_gaq.push(['_setSiteSpeedSampleRate', 50]);
  //_gaq.push(['_trackPageview']);

 // (function() {
   // var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   // ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   // var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 // })();

</script>
-->


  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script>
  

<!-- 
	window.___gcfg = {lang: 'en'};
	(function()
	{var po = document.createElement("script");
	po.type = "text/javascript"; po.async = true;po.src = "https://apis.google.com/js/plusone.js";
	var s = document.getElementsByTagName("script")[0];
	s.parentNode.insertBefore(po, s);
	})();
-->
  </script>
<!-- 
  <script>
    window.twttr = (function (d,s,id) {
      var t, js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
      js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
      return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
    }(document, "script", "twitter-wjs"));
  </script>
-->
  <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
</head>
<body onload="prettyPrint()">
    <div class="navbar navbar-fixed-top navbar-inverse" role="navigation">
      <div class="container">
        
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/"><i class="sprite-icon-dart-logo"></i></a>
        </div>

        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
           <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                       入门
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/codelabs/darrrt/">试试 Dart</a></li>
                <li><a href="/docs/tutorials/">Dart 教程</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                文档
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/docs/">开发者指南</a></li>
                <li><a href="http://api.dartlang.org">API 参考</a></li>
                <li><a href="/docs/spec/">语言规范</a></li>

                <li class="divider"></li>
                <li><a href="/docs/dart-up-and-running/">Dart: Up and Running</a></li>
                <li><a href="/books/">更多图书</a></li>

                <li class="divider"></li>
                <li><a href="/articles/">文章</a></li>
                <li><a href="/support/faq.html">FAQ</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                       工具
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/docs/dart-up-and-running/contents/ch04-tools-dart2js.html">dart2js</a>
                </li><li><a href="/tools/editor/">Dart Editor</a></li>
                <li><a href="http://pub.dartlang.org/">Pub Package Manager</a></li>
                <li><a href="/tools/">更多工具</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                     资源
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/samples/">示例代码</a></li>
                <li><a href="http://synonym.dartlang.org/">Translations from Dart</a></li>
                <li><a href="http://try.dartlang.org/">Try Dart!</a></li>

                <li class="divider"></li>
                <li><a href="/slides/">演示文稿</a></li>
                <li><a href="/dart-tips/">Dart 短视频</a></li>

                <li class="divider"></li>
                <li><a href="http://code.google.com/p/dart/issues/list">Bugs and Feature Requests</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                              社区
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/support/">支持和社区资源</a></li>
                <li><a href="http://code.google.com/p/dart/wiki/Contributing">Contributor's Guide</a></li>
              </ul>
            </li>
          </ul>

          <ul class="nav navbar-nav navbar-right">
            <li>
              <form class="navbar-search" action="/search.html" id="cse-search-box">
                <input type="hidden" name="cx" value="011220921317074318178:i4mscbaxtru">
                <input type="hidden" name="ie" value="UTF-8">
                <input type="hidden" name="hl" value="en">
                <input type="search" name="q" class="search-query placeholder-position-fix form-control" id="q" autocomplete="off" placeholder="Search">
              </form>
            </li>
            <li><a target="_blank" href="https://twitter.com/dart_lang" class="btn"><i class="sprite-icon-social-twitter"></i></a></li>
            <li><a target="_blank" href="https://plus.google.com/+dartlang/posts" class="btn"><i class="sprite-icon-social-gplus"></i></a></li>
            <li><a target="_blank" href="http://weibo.com/cndart" class="btn"><i class="sprite-icon-social-weibo"><img src="/imgs/weibo.png"></i></a></li>
          </ul>
        </div><!-- /.nav-collapse -->

      </div><!-- /.container -->
    </div><!-- /.navbar -->

  


<div class="container-page">
  <div class="container">
  	<div class="container sub-page">
    <article>
    <h1 id="dart--">异常处理 - Dart 技巧， 第九集</h1>

<!-- 
<iframe class="dart-tips-video" src="//www.youtube.com/embed/J94I70uqr6w" 
frameborder="0" allowfullscreen></iframe>
-->
<embed class="dart-tips-video" src="http://player.youku.com/player.php/sid/XNjQwODE0MDc2/v.swf" allowfullscreen="true" quality="high" width="480" height="400" align="middle" allowscriptaccess="always" type="application/x-shockwave-flash" />

<p><a href="/dart-tips/">返回 Dart 短视频技巧首页</a>.</p>

<hr />

<h3 id="section">文字稿</h3>

<p>Hi, my name is Seth Ladd and today on Dart Tips we talk about Exceptions. You
know, those errors that bubble up from deep within the bowels of your program
and tell you where something went wrong. Watch this episode so you won’t be
caught off guard the next time you run into a problem. Let’s get started!</p>

<p>Dart uses exceptions when an error or other exceptional event occurs inside your
program. When a situation arises that cannot be handled by the program or
runtime (for example when the system runs out of memory or invalid input was
provided) normal program execution stops and an exception is created. This
exception object is then thrown down the call stack, looking for someone to
catch it. If no code handles the exception, the program exits.</p>

<p>Common error cases include:</p>

<ul>
  <li>out of memory</li>
  <li>invalid input</li>
  <li>incorrect state transitions</li>
  <li>meaningless arguments</li>
  <li>and more</li>
</ul>

<p>The Dart SDK classifies most problems as errors and thus most of the exception
class names in the SDK end with error. The name error is shorter than exception,
and generally there’s nothing exceptional about many of the problems. They are
flat-out errors as in “don’t do it”. For this video, we’ll use the name
exception to mean “errors or exceptions thrown by the program or runtime”.</p>

<p>Normally, you know an exception or error has occurred when you encounter a stack
trace. They look something like this:</p>

<pre><code>Bad state: door already closed
#0      Room.closeDoor (file:///Users/sethladd/Code/dart_tips/bin/episode09.dart:14:7)
#1      example02 (file:///Users/sethladd/Code/dart_tips/bin/episode09.dart:48:17)
#2      main (file:///Users/sethladd/Code/dart_tips/bin/episode09.dart:57:12)
</code></pre>

<p>This report has useful information to help you determine what happened and where
it happened. For example, we know:</p>

<ul>
  <li>there was an unhandled exception</li>
  <li>the exception was “Bad state: door already closed”</li>
  <li>the problem occurred inside the closeDoor method</li>
  <li>at line 14</li>
  <li>in episode09.dart</li>
</ul>

<p>I feel like it’s a game of clue… “in the parlor, with the candlestick, on line
14”.</p>

<p>We can also trace the execution of the program, from the main function to the
openDoor method. This is very useful information when diagnosing and debugging
exceptions.</p>

<p>OK, with that introduction, let’s look at some code. There are four specific
concepts to explore: throw, try, catch, and finally. Each shows up as syntax
that you can use in your program.</p>

<p>In general, exceptions in Dart aren’t that invasive. For example, you can throw
any non-null object. Dart methods and functions do not declare the exceptions
they can throw, and you aren’t required to catch for exceptions a method might
throw.</p>

<p>To signal an error or exception has occurred, use throw. This is also known as
raising an exception. Here is an example:</p>

<pre class="prettyprint lang-dart">openDoor() {
  if (doorLocked) {
    throw new StateError('door locked');
  }</pre>

<p>If the door is locked, you can’t open it, so the program signals this problem by
throwing an instance of StateError.</p>

<p>Remember, you can throw any non-null object as an exception. The Dart SDK ships
classes for many common exceptions, and you can extend the Exception class to
create your own more specific exceptions.</p>

<p>For example, you may want to create a specific DoorLockedError class. Here is an
example:</p>

<pre class="prettyprint lang-dart">class DoorLockedError extends StateError {
  DoorLockedError(String msg) : super(msg);
}</pre>

<p>We’ll cover classes in a future episode, but for now it’s enough to understand
that DoorLockedError is a specific type of StateError.</p>

<p>When an object is thrown, the current function or method does not continue, and
the exception object travel through the stack, looking for someone to handle it.
Normally, you should handle exceptions gracefully and provide some sort of
mitigation or feedback to the user. Use the catch clause to capture exceptions.</p>

<p>Here is an example:</p>

<pre class="prettyprint lang-dart">try {
  room.openDoor();
  room.enter(person);
} catch(exception, stackTrace) {
  print(exception);
  print(stackTrace);
}</pre>

<p>Wrap any code that might throw an exception inside of a try block. Exceptions
thrown from within the try block are handled by the catch block. The exception
variable is the exception object itself. The stackTrace object is, no surprise
here, the stack trace.</p>

<p>It’s important to note that if openDoor() throws an exception, then enter() is
never called. Control of the program jumps to the catch block on exception.</p>

<p>If an exception is caught, you will see the following output:</p>

<pre><code>Bad state: door locked
#0      Room.openDoor (file:///Users/sethladd/Code/dart_tips/bin/episode09.dart:20:7)
#1      example02 (file:///Users/sethladd/Code/dart_tips/bin/episode09.dart:70:16)
#2      main (file:///Users/sethladd/Code/dart_tips/bin/episode09.dart:121:12)
</code></pre>

<p>The first line is the exception object, and the following lines are from the
stack trace object.</p>

<p>Here is a shorter example. You can of course name these variables however you
like. You can even omit the stack trace.</p>

<pre class="prettyprint lang-dart">try {
  room.openDoor();
  room.enter(person);
} catch(e) {
  print(e);
}</pre>

<p>Some methods can throw different exceptions, based on different conditions. For
example, the enter() method can throw a StateError if the door is not open, or
it can throw an ArgumentError if the expected argument is null.</p>

<p>Here is how you catch different types of exceptions:</p>

<pre class="prettyprint lang-dart">try {
  room.openDoor();
  room.enter(person);
} on StateError catch(e) {
  doubleCheckDoor();
} on ArgumentError catch(e) {
  reloadPerson();
} catch(e) {
  print(e);
}</pre>

<p>You can use on to specify what kind of exception you want to catch. You can
specify multiple on clauses, and you can specify a catch-all as the last catch
clause.</p>

<p>You can use on or catch or both. If you don’t care about the actual exception
object, you can omit catch:</p>

<pre class="prettyprint lang-dart">try {
  // …
} on StateError {
  // …
}</pre>

<p>Sometimes you need to ensure code runs no matter what, whether or not an
exception is thrown. Use the finally clause to make sure code is always run.
Here is an example:</p>

<pre class="prettyprint lang-dart">try {
  room.openDoor();
  room.enter(person);
} catch(e) {
  // ...
} finally {
  room.reset();
}</pre>

<p>If no exception is thrown, finally runs. If an exception is thrown from within
the try clause, catch runs, and then finally runs. In this example, the room is
always reset.</p>

<p>To recap, Dart has familiar try / catch / finally clauses. You can throw any
non-null object as an exception, and many common error cases are found in the
Dart SDK. You can have many catch clauses for a try clause, each for a specific
exception type. The finally clause runs whether or not an exception was thrown.
Client code is not forced to catch for exceptions, so it’s up to you to
determine when and how to handle potential errors.</p>

<p>Thanks for watching, I’m Seth Ladd, and as we say here on Dart Tips: stay sharp!</p>

<hr />

<p><img src="imgs/marakana-logo.png" alt="Marakana Logo" /></p>

<p>非常感谢 <a href="http://www.marakana.com">Marakana</a> 制作该系列短视频。</p>

<p><a href="/dart-tips/">返回 Dart 短视频技巧首页</a>.</p>

    </article>
    
	
    </div>
  </div>
</div>

  <footer class="footer container-full">
    <div class="container">
      <div class="row">
        <div class="col-md-5">
          <h3>一种用于创建可扩展 web 应用程序的语言、工具和代码库</h3>
          <p>Dart 是一个 <a href="https://code.google.com/p/dart/">开源项目</a>，由  Google 和其他人员参与。</p>
          <p class="sm">除非注明，该页面内容使用 the Creative Commons Attribution 3.0 License 发布，示例代码使用  BSD License 发布。</p>
          <!-- 
          <p><a class="saelogo" href="http://sae.sina.com.cn/activity/invite/15649/weibo" target="_blank"><img src="http://static.sae.sina.com.cn/image/poweredby/poweredby.png" title="Powered by Sina App Engine"></a></p>     	
          -->
        </div>
        <div class="col-md-2 col-md-offset-1">
          <h4>受欢迎的文章</h4>
          <ul>
            <li><a href="/polymer-dart/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">Polymer.dart</a></li>
            <li><a href="/performance/">性能</a></li>
            <li><a href="/docs/dart-up-and-running/contents/ch02.html?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">语言概览</a> &amp;
            <a href="/docs/dart-up-and-running/contents/ch03.html?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">代码库概览</a></li>
            <li><a href="/samples/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">示例代码</a></li>
            <li><a href="/docs/tutorials/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">教程</a> &amp;
                <a href="/codelabs/darrrt/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">代码实验室</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <h4>资源</h4>
          <ul>
            <li><a href="http://pub.dartlang.org/">Pub packages</a></li>
            <li><a href="http://synonym.dartlang.org/">Translations from Dart</a></li>
            <li><a href="http://code.google.com/p/dart/issues/list">Dart bugs and feature requests</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <h4>社区</h4>
          <ul>
            <li><a href="/support/">邮件列表</a></li>
            <li><a href="http://bbs.dartlang.cc">中文社区</a></li>
            <li><a href="https://plus.google.com/communities/114566943291919232850">G+ 社区</a></li>
            <li><a href="https://plus.google.com/+dartlang/posts">G+ 新闻发布频道</a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/dart">Stack Overflow</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer> <!-- End footer -->

<script type='text/javascript' src='/js/jquery.js'></script>
<script type='text/javascript' src='/js/bootstrap.min.js'></script>
<script type='text/javascript' src='/js/social-event-analytics.js'></script>
<script type='text/javascript' src='/js/prettify.js'></script>
<script type='text/javascript' src='/js/lang-dart.js'></script>
<script type='text/javascript' src='/js/lang-yaml.js'></script>
<script type='text/javascript' src='/js/scripts.js'></script>




<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F76b2695e71e6cec6e6af036d76afa367' type='text/javascript'%3E%3C/script%3E"));
</script>

<!-- Baidu Button BEGIN -->
<script type="text/javascript" id="bdshare_js" data="type=slide&amp;img=1&amp;pos=left&amp;uid=590574" ></script>
<script type="text/javascript" id="bdshell_js"></script>
<script type="text/javascript">
var bds_config={"bdTop":367};
document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000);
</script>
<!-- Baidu Button END -->
</body>
</html>

