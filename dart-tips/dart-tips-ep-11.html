<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Product" xmlns:wb="http://open.weibo.com/wb">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Classes: 构造函数 - Dart 技巧， 第十一集 | Dart: 用于创建结构化的web应用</title>
  <meta property="wb:webmaster" content="a984f6440858ee44" />
  <meta property="twitter:account_id" content="376585411" />
  <meta itemprop="name" content="Classes: 构造函数 - Dart 技巧， 第十一集 | Dart: 用于创建结构化的web应用">
  
  <meta itemprop="image" content="//dartpic.goodev.org/dartlang/vi/k2R_HwZzogQ/0.jpg">
  
  <meta itemprop="description" content="Dart 提供了多种构造函数，并且包含一种实现工厂模式的构造函数。学习 构造函数、变量初始化、命名构造函数、和 工厂构造函数。">

  <!-- Bootstrap core CSS -->
  <link href="/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="/css/dart-style.css" rel="stylesheet">
  <link href="/css/prettify.css" type="text/css" rel="stylesheet" />
  <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">
  <link href="//fonts.googleapis.com/css?family=Roboto:300,400" rel="stylesheet">
	
	<link rel="author" href="/authors/seth-ladd.html">
	
	<link rel="alternate" type="application/atom+xml" href="http://news.dartlang.org/feeds/posts/default" title="Atom feed">
  <!-- 
  <link href="https://plus.google.com/109866369054280216564" rel="publisher">
  -->
  <link href="http://weibo.com/cndart" rel="publisher">

  <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
  <![endif]-->

  <!-- 
<script type="text/javascript">

  //var _gaq = _gaq || [];
 // _gaq.push(['_setAccount', 'UA-26406144-4']);
  //_gaq.push(['_setDomainName', 'dartlang.org']);
  //_gaq.push(['_setSiteSpeedSampleRate', 50]);
  //_gaq.push(['_trackPageview']);

 // (function() {
   // var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   // ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   // var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 // })();

</script>
-->


  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script>
  

<!-- 
	window.___gcfg = {lang: 'en'};
	(function()
	{var po = document.createElement("script");
	po.type = "text/javascript"; po.async = true;po.src = "https://apis.google.com/js/plusone.js";
	var s = document.getElementsByTagName("script")[0];
	s.parentNode.insertBefore(po, s);
	})();
-->
  </script>
<!-- 
  <script>
    window.twttr = (function (d,s,id) {
      var t, js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
      js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
      return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
    }(document, "script", "twitter-wjs"));
  </script>
-->
  <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
</head>
<body onload="prettyPrint()">
    <div class="navbar navbar-fixed-top navbar-inverse" role="navigation">
      <div class="container">
        
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/"><i class="sprite-icon-dart-logo"></i></a>
        </div>

        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
           <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                       入门
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/codelabs/darrrt/">试试 Dart</a></li>
                <li><a href="/docs/tutorials/">Dart 教程</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                文档
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/docs/">开发者指南</a></li>
                <li><a href="http://api.dartlang.org">API 参考</a></li>
                <li><a href="/docs/spec/">语言规范</a></li>

                <li class="divider"></li>
                <li><a href="/docs/dart-up-and-running/">Dart: Up and Running</a></li>
                <li><a href="/books/">更多图书</a></li>

                <li class="divider"></li>
                <li><a href="/articles/">文章</a></li>
                <li><a href="/support/faq.html">FAQ</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                       工具
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/docs/dart-up-and-running/contents/ch04-tools-dart2js.html">dart2js</a>
                </li><li><a href="/tools/editor/">Dart Editor</a></li>
                <li><a href="http://pub.dartlang.org/">Pub Package Manager</a></li>
                <li><a href="/tools/">更多工具</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                     资源
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/samples/">示例代码</a></li>
                <li><a href="http://synonym.dartlang.org/">Translations from Dart</a></li>
                <li><a href="http://try.dartlang.org/">Try Dart!</a></li>

                <li class="divider"></li>
                <li><a href="/slides/">演示文稿</a></li>
                <li><a href="/dart-tips/">Dart 短视频</a></li>

                <li class="divider"></li>
                <li><a href="http://code.google.com/p/dart/issues/list">Bugs and Feature Requests</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                              社区
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/support/">支持和社区资源</a></li>
                <li><a href="http://code.google.com/p/dart/wiki/Contributing">Contributor's Guide</a></li>
              </ul>
            </li>
          </ul>

          <ul class="nav navbar-nav navbar-right">
            <li>
              <form class="navbar-search" action="/search.html" id="cse-search-box">
                <input type="hidden" name="cx" value="011220921317074318178:i4mscbaxtru">
                <input type="hidden" name="ie" value="UTF-8">
                <input type="hidden" name="hl" value="en">
                <input type="search" name="q" class="search-query placeholder-position-fix form-control" id="q" autocomplete="off" placeholder="Search">
              </form>
            </li>
            <li><a target="_blank" href="https://twitter.com/dart_lang" class="btn"><i class="sprite-icon-social-twitter"></i></a></li>
            <li><a target="_blank" href="https://plus.google.com/+dartlang/posts" class="btn"><i class="sprite-icon-social-gplus"></i></a></li>
            <li><a target="_blank" href="http://weibo.com/cndart" class="btn"><i class="sprite-icon-social-weibo"><img src="/imgs/weibo.png"></i></a></li>
          </ul>
        </div><!-- /.nav-collapse -->

      </div><!-- /.container -->
    </div><!-- /.navbar -->

  


<div class="container-page">
  <div class="container">
  	<div class="container sub-page">
    <article>
    <h1 id="classes----dart--">Classes: 构造函数 - Dart 技巧， 第十一集</h1>

<!-- 
<iframe class="dart-tips-video" src="//www.youtube.com/embed/k2R_HwZzogQ" 
frameborder="0" allowfullscreen></iframe>
-->
<embed class="dart-tips-video" src="http://player.youku.com/player.php/sid/XNjQwODE0NDUy/v.swf" allowfullscreen="true" quality="high" width="480" height="400" align="middle" allowscriptaccess="always" type="application/x-shockwave-flash" />

<p><a href="/dart-tips/">返回 Dart 短视频技巧首页</a>.</p>

<hr />

<h3 id="section">文字稿</h3>

<p>Hi, my name is Seth Ladd, and welcome to this episode of Dart Tips! Today we
talk about Constructors. Fun fact! You can build a constructor in Dart that
controls which object instance is returned. There’s lots of cool features with
constructors in Dart, so let’s get started!</p>

<p>Constructors are responsible for building and returning an instance of a
class. Let’s start by looking at the constructors everyone is familiar with:
what we call generative constructors. Here is an example:</p>

<pre class="prettyprint lang-dart">class FluffyBunny {
  String name;
  num fluffiness;

  FluffyBunny(String name, num fluffiness) {
    this.name = name;
    this.fluffiness;
  }
}</pre>

<p>Not a lot of surprises here. The name of the constructor matches the name of the
class. But whoa, that’s a lot of repetition! The word name is repeated three
times in the constructor alone! Surely, we can do better! And indeed we can.</p>

<p>Check this out:</p>

<pre class="prettyprint lang-dart">class FluffyBunny {
  String name;
  num fluffiness;

  FluffyBunny(this.name, this.fluffiness);
}</pre>

<p>If the constructor argument’s name is the same as a field, you can prepend the
argument with this dot. This is just syntactic sugar for the longer form
<code>this.name = name</code> and <code>this.fluffiness = fluffiness</code>. Less typing is always a
good thing.</p>

<p>Use the new keyword to create a new instance of a class. Here is an example of
calling a constructor with arguments.</p>

<pre class="prettyprint lang-dart">var floppy = new FluffyBunny('floppy', 0.72);</pre>

<p>A new instance of FluffyBunny is created, with both name and fluffiness set. Of
course, the last parameter, 0.72, isn’t exactly obvious.  Luckily, constructors
can use optional parameters just like functions and method. Here is an example:</p>

<pre class="prettyprint lang-dart">class FluffyBunny {
  String name;
  num fluffiness;

  FluffyBunny(this.name, {this.fluffiness});
}

var floppy = new FluffyBunny('floppy', fluffiness: 0.72);</pre>

<p>Now it’s a bit easier to read and understand that last parameter.</p>

<p>If your class does not explicitly define a constructor, a default constructor is
provided for you. Here’s an example of a Point class with two fields and no
explicit constructor.</p>

<pre class="prettyprint lang-dart">class Point {
  num x;
  num y;
  
  // A default, no-arg constructor
  // is provided for you if
  // no other constructor is defined.
  // Point() : super();
}

var point = new Point();</pre>

<p>The default constructor has zero arguments and invokes the no-argument
constructor of its superclass.</p>

<p>I now want to show you one of my favorite features of Dart: named constructors.
First, some background. In traditional statically typed languages, you can
overload methods by the types of parameters passed to those methods. Because
Dart is optionally typed, you can’t overload methods based on type. Which isn’t
a big deal, because you can just create differently named methods.
Traditionally, though, you were stuck with a single name for the constructor
(the name of the class often had to match the name of the constructor) and thus
you wouldn’t have been able to create multiple constructors. The designers of
the Dart language realized this and introduced named constructors as a way to
allow you to define multiple different constructors for a class.</p>

<p>Here is an example of named constructors at work:</p>

<pre class="prettyprint lang-dart">class FluffyBunny {
  FluffyBunny.fromXml(String xml) {
    // …
  }

  FluffyBunny.fromJson(String json) {
    // ...
  }
}

var xml = &quot;&lt;bunny&gt;&lt;name&gt;floppy&lt;/name&gt;&lt;/bunny&gt;&quot;;
var json = '{&quot;bunny&quot;:{&quot;name&quot;:&quot;peter&quot;}}';

var floppy = new FluffyBunny.fromXml(xml);
var peter = new FluffyBunny.fromJson(json);</pre>

<p>Notice how the new keyword is still used. I really like named constructors
because they provide an easy to read call site and they clearly state their
intention. In this case, both constructors take a string, and it’s obvious how
those strings will be used.</p>

<p>One nice feature of the Dart language is that all final fields are fully
initialized before the this handle is available. In other words, final fields
must be set before the constructor body is run. To calculate and set the value
of final fields, you can use an initializer list. Here is an example:</p>

<pre class="prettyprint lang-dart">import 'dart:math';

class Point {
  final num x;
  final num y;
  final num distanceFromOrigin;
  
  Point(x, y)
      : x = x,
        y = y,
        distanceFromOrigin = sqrt(pow(x, 2) + pow(y, 2));

}</pre>

<p>The initializers after the colon are the initializer list. The this handle is
not available in the initializer list, because at this point the object is not
yet fully created.</p>

<p>Here, Point is immutable because all fields are final. Setting x and y is
straightforward. The distanceFromOrigin field must be calculated, but it is
final, so we can’t calculate and set it in the constructor body.</p>

<p>Because this isn’t available in the initializer list, you can’t call instance
methods in the initializer list. However, top-level functions (like square root,
show here) and static methods are OK to use.</p>

<p>Speaking of initializer lists, we can now talk about calling superclass
constructors. As you see here, you can place the call to the superclass’s
constructor in the initializer list.</p>

<pre class="prettyprint lang-dart">class Bunny {
  String name;
  
  Bunny(this.name);
}

class FluffyBunny extends Bunny {
  num fluffiness;
  
  FluffyBunny(String name, this.fluffiness) : super(name);
}</pre>

<p>It’s important to understand that all field initializers are run before
constructor bodies are run. This means that the constructor body of the
superclass isn’t run until all fields from both the subclass and superclass are
initialized. We recommend you place the call to the super constructor at the end
of the initializer list to make the order more clear.</p>

<p>If you don’t explicitly call a superconstructor, a constructor will call the
default, no-arg constructor of its superclass.</p>

<pre class="prettyprint lang-dart">class Bunny {
  Bunny() {
    print('in bunny');
  }
}

class FluffyBunny extends Bunny {
  FluffyBunny() {
    print('in fluffy');
  }
}

main() {
  var floppy = new FluffyBunny();

  // in bunny
  // in fluffy
}</pre>

<p>In this case, when you create a new FluffyBunny, you’ll see “in bunny” and then
“in fluffy”. If the superclass does not have a default no-arg constructor, you
will need to explicitly call a constructor from the superclass.</p>

<p>We’ve so far seen many examples of what we call generative constructors. These
traditional constructors create a new instance of the surrounding class and
return it. While familiar, generative constructors are a bit limiting. Modular
and composable software applications require more flexible ways to build and
return objects, and entire suites of design patterns have popped up to
compensate for traditional constructor shortcomings.</p>

<p>One popular pattern is the Factory Pattern, with examples in many frameworks or
toolkits. However, without native language support for the factory pattern, most
implementations have to implement it with combinations of static methods and or
utility classes. While this works, it exposes the pattern to the consumer of the
code. Luckily, the designers of Dart added the factory pattern right into the
language. With Dart’s factory constructors, you can natively use the factory
pattern and make it appear like a regular constructor.</p>

<p>One great use case for factory constructors is to return objects from a cache.
Here’s the code:</p>

<pre class="prettyprint lang-dart">class Symbol {
  final String name;
  static Map&lt;String, Symbol&gt; _cache = new Map&lt;String, Symbol&gt;();

  factory Symbol(String name) {
    if (_cache.containsKey(name)) {
      return _cache[name];
    } else {
      final symbol = new Symbol._internal(name);
      _cache[name] = symbol;
      return symbol;
    }
  }

  Symbol._internal(this.name);
}</pre>

<p>Notice how the constructor is declared as a factory constructor. Inside the
constructor body, the cache is checked and if the symbol exists, it is returned.
Else, a new symbol is created, added to the cache, and then returned.</p>

<p>Using this class is easy, because there’s no special syntax to use a factory
constructor. Get an instance with ‘new’:</p>

<pre class="prettyprint lang-dart">main() {
  var x = new Symbol('X');
  var alsoX = new Symbol('X');

  print(identical(x, alsoX));  // true
}</pre>

<p>Both <code>x</code> and <code>alsoX</code> point to the same object, so they are identical.</p>

<p>Because the user of the class doesn’t know the constructor is really a factory,
the original author of the code is free to refactor regular constructors into
factory constructors without forcing clients to change their code. In other
words, start with a generative constructor and if you later change to a factory
constructor, no one needs to know.</p>

<p>Here’s another cool fact about factory constructors: they can even return
instances that are subclasses of the surrounding class. What other constructors
can control what type of object is returned? I think this is very cool.</p>

<p>So remember kids, while Dart might look like your friendly, neighborhood
structured language, it has productive features like terse field initialization,
named constructors, and factory constructors.</p>

<p>Thanks for watching, my name is Seth Ladd, and as we say here on Dart Tips, stay
sharp!</p>

<hr />

<p><img src="imgs/marakana-logo.png" alt="Marakana Logo" /></p>

<p>非常感谢 <a href="http://www.marakana.com">Marakana</a> 制作该系列短视频。</p>

<p><a href="/dart-tips/">返回 Dart 短视频技巧首页</a>.</p>

    </article>
    
	
    </div>
  </div>
</div>

  <footer class="footer container-full">
    <div class="container">
      <div class="row">
        <div class="col-md-5">
          <h3>一种用于创建可扩展 web 应用程序的语言、工具和代码库</h3>
          <p>Dart 是一个 <a href="https://code.google.com/p/dart/">开源项目</a>，由  Google 和其他人员参与。</p>
          <p class="sm">除非注明，该页面内容使用 the Creative Commons Attribution 3.0 License 发布，示例代码使用  BSD License 发布。</p>
          <!-- 
          <p><a class="saelogo" href="http://sae.sina.com.cn/activity/invite/15649/weibo" target="_blank"><img src="http://static.sae.sina.com.cn/image/poweredby/poweredby.png" title="Powered by Sina App Engine"></a></p>     	
          -->
        </div>
        <div class="col-md-2 col-md-offset-1">
          <h4>受欢迎的文章</h4>
          <ul>
            <li><a href="/polymer-dart/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">Polymer.dart</a></li>
            <li><a href="/performance/">性能</a></li>
            <li><a href="/docs/dart-up-and-running/contents/ch02.html?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">语言概览</a> &amp;
            <a href="/docs/dart-up-and-running/contents/ch03.html?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">代码库概览</a></li>
            <li><a href="/samples/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">示例代码</a></li>
            <li><a href="/docs/tutorials/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">教程</a> &amp;
                <a href="/codelabs/darrrt/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">代码实验室</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <h4>资源</h4>
          <ul>
            <li><a href="http://pub.dartlang.org/">Pub packages</a></li>
            <li><a href="http://synonym.dartlang.org/">Translations from Dart</a></li>
            <li><a href="http://code.google.com/p/dart/issues/list">Dart bugs and feature requests</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <h4>社区</h4>
          <ul>
            <li><a href="/support/">邮件列表</a></li>
            <li><a href="http://bbs.dartlang.cc">中文社区</a></li>
            <li><a href="https://plus.google.com/communities/114566943291919232850">G+ 社区</a></li>
            <li><a href="https://plus.google.com/+dartlang/posts">G+ 新闻发布频道</a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/dart">Stack Overflow</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer> <!-- End footer -->

<script type='text/javascript' src='/js/jquery.js'></script>
<script type='text/javascript' src='/js/bootstrap.min.js'></script>
<script type='text/javascript' src='/js/social-event-analytics.js'></script>
<script type='text/javascript' src='/js/prettify.js'></script>
<script type='text/javascript' src='/js/lang-dart.js'></script>
<script type='text/javascript' src='/js/lang-yaml.js'></script>
<script type='text/javascript' src='/js/scripts.js'></script>




<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F76b2695e71e6cec6e6af036d76afa367' type='text/javascript'%3E%3C/script%3E"));
</script>

<!-- Baidu Button BEGIN -->
<script type="text/javascript" id="bdshare_js" data="type=slide&amp;img=1&amp;pos=left&amp;uid=590574" ></script>
<script type="text/javascript" id="bdshell_js"></script>
<script type="text/javascript">
var bds_config={"bdTop":367};
document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000);
</script>
<!-- Baidu Button END -->
</body>
</html>

