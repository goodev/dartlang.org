<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Product" xmlns:wb="http://open.weibo.com/wb">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Build.dart 和 Dart 编辑器 Build 系统 | Dart: 用于创建结构化的web应用</title>
  <meta property="wb:webmaster" content="a984f6440858ee44" />
  <meta property="twitter:account_id" content="376585411" />
  <meta itemprop="name" content="Build.dart 和 Dart 编辑器 Build 系统 | Dart: 用于创建结构化的web应用">
  
  <meta itemprop="image" content="https://www.dartlang.org/imgs/dart-logo-900w.png">
  
  <meta itemprop="description" content="使用 build.dart 来改变 Dart 编辑器 build 过程。">

  <!-- Bootstrap core CSS -->
  <link href="/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="/css/dart-style.css" rel="stylesheet">
  <link href="/css/prettify.css" type="text/css" rel="stylesheet" />
  <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">
  <link href="//fonts.googleapis.com/css?family=Roboto:300,400" rel="stylesheet">
	
	
	
	<link rel="alternate" type="application/atom+xml" href="http://news.dartlang.org/feeds/posts/default" title="Atom feed">
  <!-- 
  <link href="https://plus.google.com/109866369054280216564" rel="publisher">
  -->
  <link href="http://weibo.com/cndart" rel="publisher">

  <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
  <![endif]-->

  <!-- 
<script type="text/javascript">

  //var _gaq = _gaq || [];
 // _gaq.push(['_setAccount', 'UA-26406144-4']);
  //_gaq.push(['_setDomainName', 'dartlang.org']);
  //_gaq.push(['_setSiteSpeedSampleRate', 50]);
  //_gaq.push(['_trackPageview']);

 // (function() {
   // var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
   // ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   // var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 // })();

</script>
-->


  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script>
  

<!-- 
	window.___gcfg = {lang: 'en'};
	(function()
	{var po = document.createElement("script");
	po.type = "text/javascript"; po.async = true;po.src = "https://apis.google.com/js/plusone.js";
	var s = document.getElementsByTagName("script")[0];
	s.parentNode.insertBefore(po, s);
	})();
-->
  </script>
<!-- 
  <script>
    window.twttr = (function (d,s,id) {
      var t, js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return; js=d.createElement(s); js.id=id;
      js.src="//platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs);
      return window.twttr || (t = { _e: [], ready: function(f){ t._e.push(f) } });
    }(document, "script", "twitter-wjs"));
  </script>
-->
  <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
</head>
<body onload="prettyPrint()">
    <div class="navbar navbar-fixed-top navbar-inverse" role="navigation">
      <div class="container">
        
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/"><i class="sprite-icon-dart-logo"></i></a>
        </div>

        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
           <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                       入门
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/codelabs/darrrt/">试试 Dart</a></li>
                <li><a href="/docs/tutorials/">Dart 教程</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                文档
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/docs/">开发者指南</a></li>
                <li><a href="http://api.dartlang.org">API 参考</a></li>
                <li><a href="/docs/spec/">语言规范</a></li>

                <li class="divider"></li>
                <li><a href="/docs/dart-up-and-running/">Dart: Up and Running</a></li>
                <li><a href="/books/">更多图书</a></li>

                <li class="divider"></li>
                <li><a href="/articles/">文章</a></li>
                <li><a href="/support/faq.html">FAQ</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                       工具
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/docs/dart-up-and-running/contents/ch04-tools-dart2js.html">dart2js</a>
                </li><li><a href="/tools/editor/">Dart Editor</a></li>
                <li><a href="http://pub.dartlang.org/">Pub Package Manager</a></li>
                <li><a href="/tools/">更多工具</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                                     资源
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/samples/">示例代码</a></li>
                <li><a href="http://synonym.dartlang.org/">Translations from Dart</a></li>
                <li><a href="http://try.dartlang.org/">Try Dart!</a></li>

                <li class="divider"></li>
                <li><a href="/slides/">演示文稿</a></li>
                <li><a href="/dart-tips/">Dart 短视频</a></li>

                <li class="divider"></li>
                <li><a href="http://code.google.com/p/dart/issues/list">Bugs and Feature Requests</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                              社区
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="/support/">支持和社区资源</a></li>
                <li><a href="http://code.google.com/p/dart/wiki/Contributing">Contributor's Guide</a></li>
              </ul>
            </li>
          </ul>

          <ul class="nav navbar-nav navbar-right">
            <li>
              <form class="navbar-search" action="/search.html" id="cse-search-box">
                <input type="hidden" name="cx" value="011220921317074318178:i4mscbaxtru">
                <input type="hidden" name="ie" value="UTF-8">
                <input type="hidden" name="hl" value="en">
                <input type="search" name="q" class="search-query placeholder-position-fix form-control" id="q" autocomplete="off" placeholder="Search">
              </form>
            </li>
            <li><a target="_blank" href="https://twitter.com/dart_lang" class="btn"><i class="sprite-icon-social-twitter"></i></a></li>
            <li><a target="_blank" href="https://plus.google.com/+dartlang/posts" class="btn"><i class="sprite-icon-social-gplus"></i></a></li>
            <li><a target="_blank" href="http://weibo.com/cndart" class="btn"><i class="sprite-icon-social-weibo"><img src="/imgs/weibo.png"></i></a></li>
          </ul>
        </div><!-- /.nav-collapse -->

      </div><!-- /.container -->
    </div><!-- /.navbar -->

  


<div class="container-page">
  <div class="container">
  	<div class="container sub-page">
    <article>
    <h1 id="builddart--dart--build-">Build.dart 和 Dart 编辑器 Build 系统</h1>

<p>Build.dart 是一个简单的 build 脚本，可以在 Dart 编辑器
build 系统中添加自定义行为。
如果 Dart 编辑器项目根目录中有名字为 <code>build.dart</code> 的脚本文件，
则在 build 的时候会调用该文件。
你可以使用 build.dart 来处理修改过的文件，
生成其他文件，
或者 修改 build 系统的其他行为。</p>

<div class="col-md-3">
  <div class="bs-sidebar hidden-print affix-top" role="complementary">

<ol class="toc nav bs-sidenav" id="markdown-toc">
  <li><a href="#flags">Flags</a></li>
  <li><a href="#section">一个示例</a></li>
  <li><a href="#machine-">machine 接口</a>    <ol>
      <li><a href="#errors-warnings">Errors、 warnings、和其他信息</a></li>
      <li><a href="#file-">File 映射</a></li>
    </ol>
  </li>
  <li><a href="#section-1">更多示例</a></li>
</ol>

  </div>
</div>
<div class="col-md-7">
  <p><!-- Start of content -->
	</p>

  <h2 id="flags">Flags</h2>

  <p>Dart 编辑器 可以使用如下标记来
调用 build.dart ：</p>

  <p><code>--changed=&lt;filename&gt;</code>
：指定一个文件修改过了，需要重新 build。
    对于每个修改过的文件，都会指定 <code>--changed</code> 标记。</p>

  <p><code>--removed=&lt;filename&gt;</code>
：指定该文件被删除了，可能影响 build 过程。
   对于每个删除的文件 都会指定 <code>--removed</code> 标记。</p>

  <p><code>--clean</code>
： 请求 build.dart 脚本删除所有生成的文件，
  并重置所有保存的设置。
  除了<code>--machine</code> 不用
  设置其他标记。</p>

  <p><code>--full</code>
： 请求重新 build，
  所有的增量 build 都失效。</p>

  <p><code>--machine</code>
： 请求  build.dart 在 标准输出(stdout) 打印
  JSON 格式的错误信息，
  这样在 Dart 编辑器中可以显示这些信息。</p>

  <p><code>--deploy</code>
：创建一个目录，里面包含把该应用部署到服务器的
   文件。
  只用于 <a href="/polymer-dart">Polymer.dart</a>
  linter 和 build 工具。
  在 polymer library 的
  <a href="https://code.google.com/p/dart/source/browse/trunk/dart/pkg/polymer/lib/builder.dart">builder.dart</a>
  中可以查看更多信息。</p>

  <p>当前，编辑器总是
指定 <code>--machine</code> 标记。
其他标记，例如 一个<code>--full</code>、 一个 <code>--clean</code>、一个或者多个 <code>--changed</code> 和 <code>--removed</code> 标记
都可以指定。</p>

  <p>如果 build 脚本返回非零的退出代码，
则脚本生成的所有 stdout 和 stderr 都
会显示在控制台视图中。
零退出代码 <em>不会</em> 显示任何输出信息，
build.dart 通常会调用多少，
如果不停的在控制台视图显示
滚动信息则会干扰用户。</p>

  <p>build.dart 在名字为 <code>out</code> 目录中所做的改动
使用 <code>--changed</code> 标记_不会_ 反馈到 build.dart 中。
其他的文件改动或创建文件 <em>都会</em> 反馈。</p>

  <h2 id="section">一个示例</h2>

  <p>下面是一个把所有 .foo 文件处理为 .foobar 文件
的 build.dart 脚本。</p>

  <pre class="prettyprint lang-dart">import 'dart:io';

void main() {
  for (String arg in new Options().arguments) {
    if (arg.startsWith('--changed=')) {
      String file = arg.substring('--changed='.length);

      if (file.endsWith('.foo')) {
        _processFile(file);
      }
    }
  }
}

void _processFile(String file) {
  String contents = new File(file).readAsStringSync();

  if (contents != null) {
    File outFile = new File('${file}bar');
    outFile.writeAsStringSync('// processed from ${file}:\n${contents}');
  }
}</pre>

  <h2 id="machine-">machine 接口</h2>

  <p>有时 build.dart 脚本需要反馈信息
给编辑器。script needs to
编辑器通常通过扫描 build.dart 输出
到 stdout 的特定
内容来实现该功能。
当 Dart 编辑器 启动 build.dart 的时候，
会指定一个 <code>--machine</code> 标记说明
编辑器需要特定格式的信息。</p>

  <p>特定格式的信息遵守如下规则：</p>

  <ul>
    <li>每个信息都独立位于一行。</li>
    <li>每个信息都格式化为 JSON RPC 命令/函数 。</li>
    <li>每个消息都在方括号中。</li>
  </ul>

  <p>下面显示两种类型信息：</p>

  <ul>
    <li>Errors、 warnings、和其他信息</li>
    <li>File 映射</li>
  </ul>

  <h3 id="errors-warnings">Errors、 warnings、和其他信息</h3>

  <p>当 build.dart 处理输入文件的时候，
使用 <strong>error</strong> 或者 <strong>warning</strong> 消息来显示
一些错误格式的文件。
也可以生成一般 (<strong>info</strong>) 信息，
例如，扫描用户代码中的 TODO 信息。
编辑器用这些信息来标记
文件和代码行，
并且在 问题视图 中显示这些信息。</p>

  <p>下面是 stdout 中包含
 error 和  warning 信息的示例：</p>

  <pre class="prettyprint lang-json">[{&quot;method&quot;:&quot;error&quot;,&quot;params&quot;:{&quot;file&quot;:&quot;foo.html&quot;,&quot;line&quot;:23,&quot;message&quot;:&quot;no ID found&quot;}}]

[{&quot;method&quot;:&quot;warning&quot;,&quot;params&quot;:{&quot;file&quot;:&quot;foo.html&quot;,&quot;line&quot;:23,&quot;message&quot;:&quot;no ID found&quot;}}]

[{&quot;method&quot;:&quot;error&quot;,&quot;params&quot;:{&quot;file&quot;:&quot;foo.html&quot;,&quot;line&quot;:23,&quot;message&quot;:&quot;no ID found&quot;,&quot;charStart&quot;=123,&quot;charEnd&quot;=130}}]</pre>

  <p>JSON RPC 函数名字可以为
 <strong>error</strong>、 <strong>warning</strong>、或者 <strong>info</strong>。
参数为：</p>

  <p>file
： 相对的或者绝对的脚本文件名</p>

  <p>line
：错误或者警告的行数，从 1 开始。</p>

  <p>message
： 显示给用户的信息。</p>

  <p>charStart
： 文件出错的字符开始位置，从 0 开始。</p>

  <p>charEnd
： 文件出错的字符结束位置，从 0 开始。</p>

  <p>charStart 和 charEnd 参数是可选的，但是建议提供。
包含这两个信息，编辑器可以提供友好的
 tooltip 信息来显示 错误和警告。</p>

  <h3 id="file-">File 映射</h3>

  <p>当 build.dart 脚本从输入文件生成输出文件的时候，
脚本可以告诉编辑器这些文件之间的映射关系。</p>

  <aside class="alert alert-info">
    <p><strong>注意：</strong>
并不是所有的映射关系都需要告诉编辑器，
只有一些对用户非常重要的映射才需要。</p>
  </aside>

  <p>当指定文件映射的时候，
Dart 编辑器 重定向 HTTP 请求并
使用映射的文件。
例如，
如果你把 <code>index.html</code> 映射到 <code>out/index.html</code>，
Dart 编辑器把请求 <code>index.html</code> 文件的请求重定向为  <code>out/index.html</code>，
并启动 <code>out/index.html</code> 文件来替代 <code>index.html</code>。</p>

  <p>下面是一个示例把 foo.html 映射到  out/foo.html：</p>

  <pre class="prettyprint lang-json">[{&quot;method&quot;:&quot;mapping&quot;,&quot;params&quot;:{&quot;from&quot;:&quot;foo.html&quot;,&quot;to&quot;:&quot;out/foo.html&quot;}}]</pre>

  <p>文件映射的 JSON RPC 函数名字为 <strong>mapping</strong>。
参数为：</p>

  <p>from
：相对于脚本或者绝对的 文件路径。</p>

  <p>to
：相对于脚本或者绝对的 文件路径。</p>

  <h2 id="section-1">更多示例</h2>

  <p>如下代码对于理解 build.dart 文件可能会有帮助：</p>

  <ul>
    <li><a href="https://code.google.com/p/dart/source/browse/trunk/dart/samples/build_dart/build.dart">dart/samples/build_dart/build.dart</a></li>
    <li>Web UI: 
      <ul>
        <li><a href="https://github.com/dart-lang/web-ui/blob/master/build.dart">build.dart</a></li>
        <li><a href="https://github.com/dart-lang/web-ui/blob/master/lib/component_build.dart">component_build.dart</a></li>
      </ul>
    </li>
  </ul>
</div>

    </article>
    
	
    </div>
  </div>
</div>

  <footer class="footer container-full">
    <div class="container">
      <div class="row">
        <div class="col-md-5">
          <h3>一种用于创建可扩展 web 应用程序的语言、工具和代码库</h3>
          <p>Dart 是一个 <a href="https://code.google.com/p/dart/">开源项目</a>，由  Google 和其他人员参与。</p>
          <p class="sm">除非注明，该页面内容使用 the Creative Commons Attribution 3.0 License 发布，示例代码使用  BSD License 发布。</p>
          <!-- 
          <p><a class="saelogo" href="http://sae.sina.com.cn/activity/invite/15649/weibo" target="_blank"><img src="http://static.sae.sina.com.cn/image/poweredby/poweredby.png" title="Powered by Sina App Engine"></a></p>     	
          -->
        </div>
        <div class="col-md-2 col-md-offset-1">
          <h4>受欢迎的文章</h4>
          <ul>
            <li><a href="/polymer-dart/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">Polymer.dart</a></li>
            <li><a href="/performance/">性能</a></li>
            <li><a href="/docs/dart-up-and-running/contents/ch02.html?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">语言概览</a> &amp;
            <a href="/docs/dart-up-and-running/contents/ch03.html?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">代码库概览</a></li>
            <li><a href="/samples/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">示例代码</a></li>
            <li><a href="/docs/tutorials/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">教程</a> &amp;
                <a href="/codelabs/darrrt/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">代码实验室</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <h4>资源</h4>
          <ul>
            <li><a href="http://pub.dartlang.org/">Pub packages</a></li>
            <li><a href="http://synonym.dartlang.org/">Translations from Dart</a></li>
            <li><a href="http://code.google.com/p/dart/issues/list">Dart bugs and feature requests</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <h4>社区</h4>
          <ul>
            <li><a href="/support/">邮件列表</a></li>
            <li><a href="http://bbs.dartlang.cc">中文社区</a></li>
            <li><a href="https://plus.google.com/communities/114566943291919232850">G+ 社区</a></li>
            <li><a href="https://plus.google.com/+dartlang/posts">G+ 新闻发布频道</a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/dart">Stack Overflow</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer> <!-- End footer -->

<script type='text/javascript' src='/js/jquery.js'></script>
<script type='text/javascript' src='/js/bootstrap.min.js'></script>
<script type='text/javascript' src='/js/social-event-analytics.js'></script>
<script type='text/javascript' src='/js/prettify.js'></script>
<script type='text/javascript' src='/js/lang-dart.js'></script>
<script type='text/javascript' src='/js/lang-yaml.js'></script>
<script type='text/javascript' src='/js/scripts.js'></script>




<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F76b2695e71e6cec6e6af036d76afa367' type='text/javascript'%3E%3C/script%3E"));
</script>

<!-- Baidu Button BEGIN -->
<script type="text/javascript" id="bdshare_js" data="type=slide&amp;img=1&amp;pos=left&amp;uid=590574" ></script>
<script type="text/javascript" id="bdshell_js"></script>
<script type="text/javascript">
var bds_config={"bdTop":367};
document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000);
</script>
<!-- Baidu Button END -->
</body>
</html>

